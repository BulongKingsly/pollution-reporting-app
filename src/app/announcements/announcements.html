<div class="announcements-container container mt-3">
  <h3>Announcements</h3>

  <div class="list-group mb-3">
    <ng-container *ngIf="announcements$ | async as items; else loading">
      <div *ngIf="items.length === 0" class="p-3 text-muted">No announcements yet.</div>
      <div *ngFor="let a of items" class="list-group-item">
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{ a.title }}</h5>
          <small class="text-muted">{{ a.date ? (a.date.toDate ? (a.date.toDate() | date:'short') : (a.date | date:'short')) : '' }}</small>
        </div>
        <p class="mb-1">{{ a.subtitle }}</p>
        <p class="small text-muted">{{ a.description }}</p>
        <div class="text-end"><small class="text-muted">{{ a.location || 'All' }}</small></div>
      </div>
    </ng-container>
    <ng-template #loading>
      <div class="p-3 text-muted">Loading announcements...</div>
    </ng-template>
  </div>

  <!-- Admin create form: show when user is admin -->
  <div *ngIf="(user$ | async) as user">
    <div *ngIf="user.role === 'admin'" class="card p-3">
      <h5>Create Announcement</h5>
      <div class="mb-2">
        <input class="form-control" placeholder="Title" [(ngModel)]="model.title" />
      </div>
      <div class="mb-2">
        <input class="form-control" placeholder="Subtitle" [(ngModel)]="model.subtitle" />
      </div>
      <div class="mb-2">
        <textarea class="form-control" rows="3" placeholder="Description" [(ngModel)]="model.description"></textarea>
      </div>
      <div class="mb-2 d-flex gap-2">
        <select title="Announcement target" class="form-select w-auto" [(ngModel)]="model.location">
          <option value="all">All barangays</option>
          <option value="local">My barangay</option>
        </select>
        <button class="btn btn-primary" (click)="post()">Post</button>
      </div>
    </div>
  </div>
</div>
