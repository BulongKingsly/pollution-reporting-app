<div class="container mt-4">
  <div *ngIf="barangay; else loading">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">{{ barangay.name }} ‚Äî Barangay Admin</h3>
      <button class="btn btn-outline-secondary" (click)="router.navigate(['/admin'])">
        <i class="fas fa-arrow-left me-2"></i>Back to Admin Dashboard
      </button>
    </div>

    <div class="row">
      <!-- Toasts -->
      <div class="toast-container top-right">
        <div *ngFor="let t of toasts" class="toast show mb-2 align-items-center text-bg-{{ t.type }}" role="alert">
          <div class="d-flex">
            <div class="toast-body">{{ t.message }}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" aria-label="Close toast" (click)="removeToast(t.id)"></button>
          </div>
        </div>
      </div>

      <!-- Confirm modal -->
      <div class="modal" tabindex="-1" [class.show]="confirmVisible" [style.display]="confirmVisible ? 'block' : 'none'">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Confirm</h5>
              <button type="button" class="btn-close" aria-label="Close dialog" (click)="onConfirmAnswer(false)"></button>
            </div>
            <div class="modal-body">
              <p>{{ confirmMessage }}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="onConfirmAnswer(false)">Cancel</button>
              <button type="button" class="btn btn-danger" (click)="onConfirmAnswer(true)">Yes</button>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-body">
            <h5>Streets</h5>
            <ul class="list-group mb-2">
              <li *ngFor="let s of barangay.streets" class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ getStreetName(s) }}</strong>
                  <small class="text-muted d-block" *ngIf="getStreetCoords(s)">üìç {{ getStreetCoords(s) }}</small>
                </div>
                <button class="btn btn-sm btn-outline-danger" (click)="removeStreet(s)">Remove</button>
              </li>
            </ul>
            <div class="mb-2">
              <label class="form-label">Street Name</label>
              <input class="form-control mb-2" [(ngModel)]="newStreet" placeholder="Street name" title="Street name">
              <label class="form-label">Coordinates (optional)</label>
              <div class="row g-2">
                <div class="col-6">
                  <input class="form-control" type="number" step="0.000001" [(ngModel)]="newStreetLat" placeholder="Latitude" title="Latitude">
                </div>
                <div class="col-6">
                  <input class="form-control" type="number" step="0.000001" [(ngModel)]="newStreetLng" placeholder="Longitude" title="Longitude">
                </div>
              </div>
              <small class="text-muted d-block mt-1">üí° Tip: Use <a href="https://www.google.com/maps" target="_blank" rel="noopener">Google Maps</a> to find coordinates</small>
            </div>
            <button class="btn btn-primary w-100" (click)="addStreet()">Add Street</button>
          </div>
        </div>

        <div class="card mb-3">
          <div class="card-body">
            <h5>Pollution Types</h5>
            <ul class="list-group mb-2">
              <li *ngFor="let t of barangay.pollutionTypes" class="list-group-item d-flex justify-content-between align-items-center">
                {{ t }}
                <button class="btn btn-sm btn-outline-danger" (click)="removeType(t)">Remove</button>
              </li>
            </ul>
            <div class="input-group">
              <input class="form-control" [(ngModel)]="newType" placeholder="Add new type" title="Add new pollution type">
              <button class="btn btn-primary" (click)="addType()">Add</button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-body">
            <h5>Reports</h5>
            <div *ngIf="reports.length === 0" class="text-muted">No reports yet.</div>
            <div *ngFor="let r of reports" class="card mb-2">
              <div class="card-body">
                <h6>{{ r.type | titlecase }} ‚Äî {{ r.location }}</h6>
                <p class="mb-1">{{ r.description }}</p>
                <small class="text-muted">By {{ r.reporterName }} ‚Ä¢ {{ r.createdAt | date:'short' }}</small>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <h5>Users in barangay</h5>
            <ul class="list-group">
              <li *ngFor="let u of users" class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <div>{{ u.email }}</div>
                  <small class="text-muted">{{ u.uid }}</small>
                </div>
                <div class="d-flex gap-2 align-items-center">
                  <span class="badge bg-secondary">{{ u.role }}</span>
                  <button *ngIf="u.role !== 'admin'" class="btn btn-sm btn-outline-primary" (click)="promoteUserToAdmin(u)">Promote</button>
                  <button *ngIf="u.role === 'admin'" class="btn btn-sm btn-outline-warning" (click)="demoteAdminToUser(u)">Demote</button>
                  <button class="btn btn-sm btn-outline-danger" (click)="suspendUser(u)">Suspend</button>
                </div>
              </li>
            </ul>
          </div>
        </div>

        <div class="card mb-3">
          <div class="card-body">
            <h5>Post Announcement (Barangay)</h5>
            <div class="mb-2">
              <input class="form-control mb-2" [(ngModel)]="announcementModel.title" placeholder="Title">
              <input class="form-control mb-2" [(ngModel)]="announcementModel.subtitle" placeholder="Subtitle (optional)">
              <textarea class="form-control mb-2" rows="3" [(ngModel)]="announcementModel.description" placeholder="Message"></textarea>
              <button class="btn btn-success" (click)="postBarangayAnnouncement()">Post to Barangay</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <ng-template #loading>
    <p class="text-muted">Loading barangay data...</p>
  </ng-template>
</div>
